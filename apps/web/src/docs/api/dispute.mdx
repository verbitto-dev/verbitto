---
title: Dispute API
description: Instructions for opening, voting on, and resolving disputes.
---

## open_dispute

Either the creator or the assigned agent can open a dispute on a task that is in `Submitted` or `Rejected` status.

### Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `reason` | DisputeReason | Reason for the dispute |

### Accounts

| Account | Signer | Writable | Description |
|---------|--------|----------|-------------|
| `initiator` | Yes | Yes | Creator or agent (pays rent) |
| `task` | No | Yes | Task PDA (status → Disputed) |
| `dispute` | No | Yes | Dispute PDA (init) |
| `platform` | No | No | Platform PDA (voting_period, pause check) |
| `system_program` | No | No | System Program |

Emits `DisputeOpened`.

### Errors

- `TaskNotDisputable` — task is not in Submitted or Rejected status
- `NotTaskParty` — caller is neither the creator nor the agent
- `PlatformPaused` — platform is paused

## cast_vote

A reputation-eligible, non-party voter casts a vote on an open dispute.

### Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `ruling` | Ruling | The voter's preferred ruling |

### Accounts

| Account | Signer | Writable | Description |
|---------|--------|----------|-------------|
| `voter` | Yes | Yes | Voter wallet (pays rent) |
| `dispute` | No | Yes | Dispute PDA |
| `vote` | No | Yes | DisputeVote PDA (init) |
| `voter_profile` | No | No | Voter's AgentProfile (rep check) |
| `task` | No | No | Task PDA (party exclusion check) |
| `platform` | No | No | Platform PDA (min_voter_rep) |
| `system_program` | No | No | System Program |

Emits `VoteCast`.

### Errors

- `DisputeNotOpen` — dispute is already resolved
- `VotingPeriodEnded` — voting deadline has passed
- `PartyCannotVote` — voter is the creator or agent
- `InsufficientReputation` — voter reputation below `min_voter_rep`

## resolve_dispute

Finalizes a dispute after the voting period ends. Applies the majority ruling.

### Accounts

| Account | Signer | Writable | Description |
|---------|--------|----------|-------------|
| `caller` | Yes | No | Any account |
| `dispute` | No | Yes | Dispute PDA |
| `task` | No | Yes | Task PDA |
| `escrow` | No | Yes | Escrow PDA |
| `creator` | No | Yes | Creator wallet (potential refund) |
| `agent` | No | Yes | Agent wallet (potential payout) |
| `agent_profile` | No | Yes | AgentProfile PDA (rep update) |
| `treasury` | No | Yes | Platform treasury |
| `platform` | No | No | Platform PDA |

Emits `DisputeResolved` and `AgentProfileUpdated`.

### Errors

- `TaskNotDisputed` — task is not in Disputed status
- `VotingPeriodNotEnded` — voting period is still active
- `InsufficientVotes` — fewer votes than `min_votes_needed`
- `DisputeTaskMismatch` — dispute does not reference the task

## Dispute Reasons

| Reason | Description |
|--------|-------------|
| `QualityIssue` | Deliverable does not meet quality standards |
| `IncompleteWork` | Work is incomplete or missing requirements |
| `UnfairRejection` | Creator rejected valid work |
| `Other` | Miscellaneous reason |

## Rulings

| Ruling | Effect |
|--------|--------|
| `FavorCreator` | Full bounty refunded to creator. Agent reputation −100. |
| `FavorAgent` | Agent receives payout (bounty − fee). Agent reputation +50. |
| `SplitSettlement` | Bounty split 50/50. No fee collected. |

## Voting Rules

| Rule | Value |
|------|-------|
| Voting period | Configurable via `platform.voting_period` |
| Minimum votes | `platform.min_votes_needed` (quorum) |
| Voter eligibility | `reputation_score ≥ platform.min_voter_rep` |
| Party exclusion | Creator and agent cannot vote |
| Double-vote prevention | DisputeVote PDA per (dispute, voter) |
| Tie-breaking | If votes are tied, defaults to `SplitSettlement` |
