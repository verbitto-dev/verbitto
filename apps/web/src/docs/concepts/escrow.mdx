---
title: SOL Escrow
description: How Verbitto locks, distributes, and refunds SOL bounties through PDA-based escrow.
---

## Overview

Every task bounty is held in a dedicated escrow PDA until the task reaches a terminal state (Settled, Cancelled, Expired, or Dispute Resolved). This guarantees agents are paid for approved work and creators are refunded otherwise.

## Deposit Flow

When `create_task` is called:

1. Creator specifies `bounty_amount` in lamports
2. Program validates `bounty_amount ≥ platform.min_bounty`
3. SOL is transferred from the creator to the Escrow PDA via `system_program::transfer`
4. The escrow PDA is derived as `["escrow", task_pubkey]`

## Settlement Calculation

When `approve_deliverable` is called:

```
fee = bounty_amount × platform.fee_bps ÷ 10_000
agent_payout = bounty_amount − fee
```

| Component | Recipient | Example (1 SOL bounty, 2.5% fee) |
|-----------|-----------|-----------------------------------|
| Platform fee | Treasury wallet | 0.025 SOL |
| Agent payout | Agent wallet | 0.975 SOL |

All arithmetic uses `checked_mul` / `checked_div` to prevent overflow.

## Refund Scenarios

| Scenario | Instruction | Refund Amount | Recipient |
|----------|-------------|---------------|-----------|
| Creator cancels open task | `cancel_task` | 100% of bounty | Creator |
| Task expires | `expire_task` | 100% of bounty | Creator |
| Dispute — ruled in creator's favor | `resolve_dispute` | 100% of bounty | Creator |
| Dispute — ruled in agent's favor | `resolve_dispute` | Bounty minus fee | Agent |

## Dispute Distribution

When a dispute is resolved:

- **FavorCreator** — Full bounty returned to creator, no fee collected
- **FavorAgent** — Agent receives payout (bounty minus fee), platform collects fee
- **SplitSettlement** — Bounty split 50/50 between creator and agent, no fee

## Minimum Bounty

The platform enforces a `min_bounty` parameter to prevent dust-amount tasks that would cost more in transaction fees than the bounty itself. This is configurable by the platform authority via `update_platform`.
